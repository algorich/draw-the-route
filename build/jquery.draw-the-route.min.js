!function(a){"use strict";a.fn.drawTheRoute=function(b){var c=a.extend({zoom:14,center:[-15.7941454,-47.88254789999996],attachToRoad:!0,lineColor:"#FF0000",nodes:[]},b),d=new google.maps.Map(document.getElementById(this.prop("id")),{center:new google.maps.LatLng(c.center[0],c.center[1]),zoom:c.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP}),e={settings:c,map:d,markers:[],directionsService:new google.maps.DirectionsService,directionsDisplay:new google.maps.DirectionsRenderer({preserveViewport:!0}),nodes:{elements:[],last:function(a){return a=a||1,this.elements.slice(-a)[0]},first:function(){return this.elements[0]},all:function(){return this.elements},waypoints:function(){return this.elements.slice(1,this.size())},size:function(){return this.elements.length},push:function(a){this.elements.push(a)},pop:function(){return this.elements.pop()},"export":function(){return a.map(this.all(),function(a){return[[a.k,a.B]]})}},attachToRoad:function(a){return void 0===a?c.attachToRoad:void(c.attachToRoad=a)},newMarker:function(){return new google.maps.Marker({position:this.nodes.last(),map:this.map})},updateMarkers:function(){if(this.markers.length>1){var a=this.markers.pop();a.setMap(null)}this.markers.push(this.newMarker())},drawLine:function(){void 0!==this.route&&(this.route.setMap(null),delete this.route),this.route=new google.maps.Polyline({path:this.nodes.all(),strokeColor:this.settings.lineColor,strokeOpacity:1,strokeWeight:2,map:this.map}),this.updateMarkers()},drawRoute:function(){var b=this;if(this.nodes.size()>0){var c=this.nodes.first(),d=this.nodes.last(),e=this.nodes.waypoints(),f={origin:c,destination:d,waypoints:a.map(e,function(a){return{location:a,stopover:!1}}),travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.IMPERIAL};this.directionsService.route(f,function(a,c){c===google.maps.DirectionsStatus.OK&&b.directionsDisplay.setDirections(a)})}},draw:function(){this.settings.attachToRoad?this.drawRoute():this.drawLine()},closed:function(){return this.nodes.first()===this.nodes.last()},closeRoute:function(){var a=this.nodes.size()>2;a&&!this.closed()&&(this.nodes.push(this.nodes.first()),this.draw())},undo:function(){this.nodes.size()>0&&(this.nodes.pop(),this.draw())},exportData:function(){return this.settings.nodes=this.nodes.export(),this.settings}};return e.directionsDisplay.setMap(e.map),function(){var b=a.map(c.nodes,function(a){return new google.maps.LatLng(a[0],a[1])});e.nodes.elements=b,e.draw()}(),google.maps.event.addListener(e.map,"click",function(a){e.nodes.push(a.latLng),e.draw()}),e}}(jQuery);