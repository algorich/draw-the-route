!function(a){"use strict";a.fn.drawTheRoute=function(b){var c=function(a){return a[a.length-1]},d=a.extend({zoom:14,center:[-15.7941454,-47.88254789999996],attachToRoad:!0,lineColor:"#FF0000",nodes:[]},b),e=new google.maps.Map(document.getElementById(this.prop("id")),{center:new google.maps.LatLng(d.center[0],d.center[1]),zoom:d.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP}),f={settings:d,map:e,resetResources:function(){this.directionsDisplays.destroyAll(),this.waypoints.destroyAll(),this.markers.clean(),this.nodes.destroyAll()},initializeSearchBox:function(){var a=document.getElementById("pac-input");e.controls[google.maps.ControlPosition.TOP_LEFT].push(a);var b=new google.maps.places.SearchBox(a);google.maps.event.addListener(b,"places_changed",function(){var a=b.getPlaces();if(0!=a.length){for(var c,d=new google.maps.LatLngBounds,g=0;c=a[g];g++)d.extend(c.geometry.location);f.resetResources(),e.fitBounds(d),e.setZoom(17)}})},directionsService:new google.maps.DirectionsService,directionsDisplays:{elements:[],pop:function(){var a=this.elements.pop();return a?(a.setMap(null),a):void 0},showAll:function(){a.each(this.elements,function(a,b){b.setMap(f.map)})},create:function(){var a=new google.maps.DirectionsRenderer({preserveViewport:!0,suppressMarkers:!0});a.setMap(f.map),this.elements.push(a)},destroyAll:function(){a.each(this.elements,function(a,b){b.setMap(null)}),this.elements=[]}},waypoints:{SIZE_LIMIT:8,elements:[],count:0,push:function(a){var b=c(this.elements);void 0===b?(this.elements.push([a]),f.directionsDisplays.create()):b.length<8?this.elements[this.elements.length-1].push(a):(this.elements.push([c(b),a]),f.directionsDisplays.create())},pop:function(){var a,b=c(this.elements);return void 0===b?null:(b.length<=2?(this.elements.pop(),a=f.directionsDisplays.pop()):a=this.elements[this.elements.length-1].pop(),a)},destroyAll:function(){this.elements=[],this.count=[]}},markers:{icons:{startFinish:new google.maps.MarkerImage("lib/images/start_finish_flag.png"),start:new google.maps.MarkerImage("lib/images/green_flag.png"),end:new google.maps.MarkerImage("lib/images/red_flag.png")},elements:[],create:function(a,b){this.elements.push(new google.maps.Marker({position:a||f.nodes.last(),map:f.map,icon:b}))},clean:function(){a.each(this.elements,function(a,b){b.setMap(null)}),this.elements=[]},show:function(){this.clean(),f.nodes.first()==f.nodes.last()?this.create(f.nodes.first(),this.icons.startFinish):(this.create(f.nodes.first(),this.icons.start),this.create(f.nodes.last(),this.icons.end))}},nodes:{elements:[],last:function(a){return a=a||1,this.elements.slice(-a)[0]},first:function(){return this.elements[0]},all:function(){return this.elements},size:function(){return this.elements.length},push:function(a){this.elements.push(a),f.waypoints.push(a)},pop:function(){return f.waypoints.pop(),this.elements.pop()},"export":function(){return a.map(this.all(),function(a){return[[a.k,a.B]]})},destroyAll:function(){this.elements=[]}},toggleRoute:function(b){b===!1?a.map(f.directionsDisplays.elements,function(a){return a.setMap(null)}):(this.route.setMap(null),f.directionsDisplays.showAll()),this.draw()},attachToRoad:function(a){return void 0===a?d.attachToRoad:(d.attachToRoad=a,void this.toggleRoute(a))},drawLine:function(){void 0!==this.route&&(this.route.setMap(null),delete this.route),this.route=new google.maps.Polyline({path:this.nodes.all(),strokeColor:this.settings.lineColor,strokeOpacity:1,strokeWeight:2,map:this.map}),this.markers.show()},createRoadRoute:function(b,c){var d={origin:b[0],destination:b[b.length-1],waypoints:a.map(b,function(a){return{location:a,stopover:!1}}),travelMode:google.maps.TravelMode.WALKING,unitSystem:google.maps.UnitSystem.IMPERIAL};f.directionsService.route(d,function(a,b){b===google.maps.DirectionsStatus.OK&&f.directionsDisplays.elements[c].setDirections(a)})},drawRoute:function(){if(this.nodes.size()>=2){var b=f.waypoints.elements;a.each(b,function(a,b){f.createRoadRoute(b,a)})}f.markers.show()},draw:function(){this.settings.attachToRoad?this.drawRoute():this.drawLine()},closed:function(){return this.nodes.first()===this.nodes.last()},closeRoute:function(){var a=this.nodes.size()>2;a&&!this.closed()&&(this.nodes.push(this.nodes.first()),this.draw())},undo:function(){this.nodes.size()>0&&(this.nodes.pop(),this.draw())},exportData:function(){return this.settings.nodes=this.nodes.export(),this.settings}};return function(){a.map(d.nodes,function(a){f.nodes.push(new google.maps.LatLng(a[0],a[1]))});f.draw()}(),f.initializeSearchBox(),google.maps.event.addListener(f.map,"click",function(a){f.nodes.push(a.latLng),f.draw()}),f}}(jQuery);